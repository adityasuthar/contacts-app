<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% load static %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="{% static 'contacts/style.css' %}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&display=swap"
      rel="stylesheet"
    />
    <title>{% block title %}Contacts{% endblock %}</title>
    <script>
      (function () {
        var k = "contacts-theme";
        var s = localStorage.getItem(k);
        var d = document.documentElement;
        if (s === "dark" || s === "light") d.setAttribute("data-theme", s);
        else if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) d.setAttribute("data-theme", "dark");
        else d.setAttribute("data-theme", "light");
      })();
    </script>
    {% block extra_head %}{% endblock %}
  </head>
  <body>
    <nav class="app-navbar">
      <div class="container">
        <a class="navbar-brand" href="{% url 'contact_list' %}">Contacts</a>
        <div class="navbar-nav-wrap">
          <button type="button" class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
          </button>
          {% if user.is_authenticated %}
          <span class="nav-user">Hi, {{ user.username }}</span>
          <a class="btn btn-nav btn-logout" href="{% url 'logout' %}">Logout</a>
          {% else %}
          <a class="btn btn-nav btn-login" href="{% url 'login' %}">Login</a>
          <a class="btn btn-nav btn-register" href="{% url 'register' %}">Register</a>
          {% endif %}
        </div>
      </div>
    </nav>

    <main class="app-main">
      {% block content %}{% endblock %}
    </main>

    <footer class="app-footer">
      <div class="container text-center">
        <span>Contacts App</span>
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXnTWWnCHtXb/M"
      crossorigin="anonymous"
    ></script>
    <script>
      (function () {
        var STORAGE_KEY = "contacts-theme";
        var toggle = document.getElementById("theme-toggle");
        var root = document.documentElement;

        function getStored() {
          return localStorage.getItem(STORAGE_KEY);
        }
        function setStored(value) {
          if (value) localStorage.setItem(STORAGE_KEY, value);
          else localStorage.removeItem(STORAGE_KEY);
        }
        function applyTheme(theme) {
          root.setAttribute("data-theme", theme || "light");
        }
        function init() {
          var stored = getStored();
          if (stored === "dark" || stored === "light") {
            applyTheme(stored);
          } else if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
            applyTheme("dark");
          } else {
            applyTheme("light");
          }
        }
        function nextTheme() {
          var current = root.getAttribute("data-theme");
          var next = current === "dark" ? "light" : "dark";
          applyTheme(next);
          setStored(next);
        }

        init();
        if (toggle) toggle.addEventListener("click", nextTheme);
      })();
    </script>
    {% block extra_scripts %}{% endblock %}
  </body>
</html>
